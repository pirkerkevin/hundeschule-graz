<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Warenkorb ‚Äì Kevin‚Äôs Hundeschule Graz</title>
  <link rel="stylesheet" href="../assets/ui.css?v=6">
  <style>
    .cart{display:grid;gap:16px}
    .cart-items .row{display:grid;grid-template-columns:1fr auto auto auto auto;gap:10px;align-items:center;padding:10px;border-bottom:1px dashed var(--border)}
    .cart-items .row:last-child{border-bottom:0}
    .muted{opacity:.8}
    .totals{border:1px solid var(--border);border-radius:16px;background:var(--card);padding:16px;box-shadow:var(--shadow)}
    .promo-box{display:flex;gap:8px;flex-wrap:wrap}
    .qty{display:inline-flex;border:1px solid var(--border);border-radius:10px;overflow:hidden}
    .qty button{border:0;background:#fff;padding:6px 10px;cursor:pointer}
    .qty input{width:48px;text-align:center;border:0}
    .trash-btn{background:transparent;border:0;cursor:pointer;color:#a44;font-size:1.1rem;line-height:1}
    .trash-btn:hover{color:#d33}
    @media(max-width:900px){.cart-items .row{grid-template-columns:1fr auto auto auto} .cart-items .row .cell-remove{grid-column:1 / -1; text-align:right}}
    @media(max-width:720px){.cart-items .row{grid-template-columns:1fr auto auto} .cart-items .row .muted{display:none} .cart-items .row .cell-sum{display:none} .cart-items .row .cell-remove{grid-column:auto; text-align:left}}
  </style>
</head>
<body>
<a href="#start" class="skip-link">Zum Inhalt springen</a>
<header class="wrapper site-header">
  <nav class="nav"><a class="brand" href="../index.html">Kevin‚Äôs Hundeschule Graz</a>
    <div>
      <a class="cart-icon" href="../shop/checkout.html" aria-label="Warenkorb √∂ffnen">üõí<span class="cart-badge" id="cartBadge">0</span></a>
      <button class="menu-toggle" aria-label="Men√º √∂ffnen" aria-controls="quick-menu" aria-expanded="false"><span class="menu-bars"></span></button>
    </div>
    <div id="quick-menu" class="quick-menu" hidden>
      <ul>
        <li><a href="../index.html">Start</a></li><li><a href="../leistungen/index.html">Leistungen</a></li>
        <li><a href="../blog/index.html">Blog</a></li><li><a href="../faq.html">FAQ</a></li>
        <li><a href="../ueber-uns/index.html">√úber uns</a></li><li><a href="../gutscheine.html">Gutscheine</a></li>
        <li><a href="../shop/checkout.html" aria-current="page">Kasse</a></li><li><a href="../kontakt.html">Kontakt</a></li>
      </ul>
    </div>
  </nav>
</header>

<main class="wrapper" id="start">
  <h1 class="reveal" style="text-align:center">Warenkorb</h1>

  <section class="cart reveal">
    <div class="cart-items" id="cartItems"></div>

    <div class="totals">
      <h2 style="margin-top:0">Zusammenfassung</h2>

      <div class="promo-box" style="margin-bottom:10px">
        <input id="promoInput" placeholder="Promocode (optional)" style="flex:1;min-width:220px;padding:10px;border:1px solid var(--border);border-radius:10px">
        <button class="cta" id="applyPromo">Code anwenden</button>
        <button class="promo-close" id="clearPromo" title="Code entfernen">Entfernen</button>
      </div>
      <p class="small" id="promoInfo" style="min-height:1.2em"></p>

      <p>Zwischensumme: <strong id="sub"></strong> ‚Ç¨</p>
      <p id="discRow" style="display:none">Rabatt: <strong id="disc"></strong> ‚Ç¨</p>
      <p style="font-size:1.15rem">Gesamt: <strong id="total"></strong> ‚Ç¨</p>

      <p style="display:flex;gap:8px;flex-wrap:wrap">
        <a class="cta" href="../gutscheine.html">Weiter einkaufen</a>
        <a class="cta-primary" href="../shop/checkout.html">Zur Kasse</a>
      </p>
    </div>
  </section>
</main>

<footer class="wrapper" role="contentinfo">
  <small>¬© 2025 Kevin‚Äôs Hundeschule Graz ¬∑ <a href="../impressum.html">Impressum</a> ¬∑ <a href="../agb.html">AGB</a> ¬∑ <a href="../datenschutz.html">Datenschutz</a></small>
</footer>

<script src="../assets/menu.js?v=6" defer></script>
<script src="../assets/cart.js?v=1" defer></script>
<script>
const CART_KEY='cart_items';const PROMO_KEY='cart_promo';
const VALID_CODES={'HUND10':0.10,'HUND-10':0.10,'HUND_10':0.10};
function loadCart(){try{return JSON.parse(localStorage.getItem(CART_KEY))||[]}catch(e){return []}}
function saveCart(items){localStorage.setItem(CART_KEY,JSON.stringify(items))}
function getPromo(){try{return JSON.parse(localStorage.getItem(PROMO_KEY))}catch(e){return null}}
function setPromo(code,pct){localStorage.setItem(PROMO_KEY,JSON.stringify({code,pct}))}
function clearPromo(){localStorage.removeItem(PROMO_KEY)}
function fmt(n){return Number(n||0).toLocaleString('de-AT',{minimumFractionDigits:2,maximumFractionDigits:2})}

const elItems = document.getElementById('cartItems');
const elSub   = document.getElementById('sub');
const elDisc  = document.getElementById('disc');
const elDiscRow = document.getElementById('discRow');
const elTot   = document.getElementById('total');
const promoInput = document.getElementById('promoInput');
const promoInfo  = document.getElementById('promoInfo');

function render(){
  const items = loadCart();
  if(items.length===0){
    elItems.innerHTML = '<p class="small">Dein Warenkorb ist leer.</p>';
  }else{
    elItems.innerHTML = `
      <div class="row muted">
        <div>Artikel</div><div>Preis</div><div>Menge</div><div>Summe</div><div></div>
      </div>
      ${items.map((it,idx)=>`
        <div class="row">
          <div>${it.name}</div>
          <div>${fmt(it.price)} ‚Ç¨</div>
          <div class="qty">
            <button aria-label="‚Äì" onclick="chgQty(${idx},-1)">‚Äì</button>
            <input value="${it.qty||1}" readonly>
            <button aria-label="+" onclick="chgQty(${idx},1)">+</button>
          </div>
          <div class="cell-sum">${fmt((it.qty||1)*it.price)} ‚Ç¨</div>
          <div class="cell-remove"><button class="trash-btn" aria-label="Entfernen" onclick="delItem(${idx})">üóëÔ∏è</button></div>
        </div>
      `).join('')}
    `;
  }
  calcTotals();
}

function chgQty(i, d){
  const items = loadCart();
  if(!items[i]) return;
  items[i].qty = Math.max(1, (items[i].qty||1)+d);
  saveCart(items); render();
}

function delItem(i){
  const items = loadCart();
  items.splice(i,1);
  saveCart(items);
  render();
}

function calcTotals(){
  const items = loadCart();
  const sub = items.reduce((s,it)=> s + (it.price * (it.qty||1)), 0);
  elSub.textContent = fmt(sub);

  const promo = getPromo();
  let discAmt = 0;
  if(promo && promo.pct>0){
    discAmt = sub * promo.pct;
    elDisc.textContent = '‚Äì ' + fmt(discAmt);
    elDiscRow.style.display = '';
    promoInfo.textContent = `Rabatt aktiv: ‚Äì${Math.round(promo.pct*100)} %`;
  } else {
    elDiscRow.style.display = 'none';
    promoInfo.textContent = '';
  }

  const total = Math.max(0, sub - discAmt);
  elTot.textContent = fmt(total);
}
document.getElementById('applyPromo').addEventListener('click', ()=>{
  const codeRaw = promoInput.value.trim().toUpperCase();
  if(!codeRaw){ clearPromo(); calcTotals(); promoInfo.textContent=''; return; }
  const pct = VALID_CODES[codeRaw] || 0;
  if(pct>0){ setPromo('PROMO', pct); calcTotals(); }
  else { promoInfo.textContent = 'Ung√ºltiger Code.'; clearPromo(); calcTotals(); }
});
document.getElementById('clearPromo').addEventListener('click', ()=>{ clearPromo(); promoInput.value=''; calcTotals(); });
render();
</script>
</body>
</html>
